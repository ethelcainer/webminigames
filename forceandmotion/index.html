<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newton's Delivery Dash</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            overflow: hidden;
            background: linear-gradient(to bottom, #7dd3fc, #38bdf8);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cloud {
            position: absolute;
            background: white;
            border-radius: 50px;
            opacity: 0.5;
            animation: move linear infinite;
            z-index: 0;
        }
        @keyframes move {
            from { transform: translateX(-250px); }
            to { transform: translateX(100vw); }
        }

        .bubbly-button {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        .bubbly-button:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 rgba(0,0,0,0.1);
        }
        .bubbly-button:hover {
            filter: brightness(1.05);
            transform: scale(1.01);
        }

        .gradient-bg {
            background: linear-gradient(180deg, #bae6fd 0%, #f0f9ff 100%);
        }

        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <!-- Background Decoration -->
    <div class="cloud w-32 h-8 top-10" style="animation-duration: 45s;"></div>
    <div class="cloud w-56 h-12 top-32" style="animation-duration: 70s; animation-delay: -10s;"></div>
    <div class="cloud w-44 h-10 bottom-20" style="animation-duration: 55s; animation-delay: -25s;"></div>

    <!-- Game Container -->
    <div id="game-container" class="relative w-full max-w-6xl bg-white/90 backdrop-blur-sm rounded-[2.5rem] shadow-2xl overflow-hidden border-4 border-white m-4 z-10 flex flex-col">
        
        <!-- START SCREEN -->
        <div id="start-screen" class="absolute inset-0 bg-blue-500 z-50 flex flex-col items-center justify-center p-8 text-center transition-all duration-500">
            <div class="mb-4">
                <svg width="100" height="100" viewBox="0 0 100 100">
                    <rect x="20" y="30" width="60" height="50" rx="12" fill="white" />
                    <rect x="30" y="40" width="40" height="22" rx="4" fill="#1e3a8a" />
                    <circle cx="40" cy="51" r="4" fill="#60a5fa" />
                    <circle cx="60" cy="51" r="4" fill="#60a5fa" />
                    <circle cx="50" cy="15" r="7" fill="#fbbf24" />
                    <rect x="48" y="15" width="4" height="15" fill="white" />
                </svg>
            </div>
            <h1 class="text-5xl font-black text-white mb-3 tracking-tight">Newton's Dash!</h1>
            <p class="text-blue-100 text-lg mb-8 max-w-md font-medium">Deliver packages by balancing force and friction. Can you clear all 5 stages?</p>
            <button id="begin-btn" class="bubbly-button bg-white text-blue-600 px-14 py-4 rounded-2xl text-2xl font-black shadow-xl">
                START MISSION
            </button>
        </div>

        <!-- HUD / Status -->
        <div class="absolute top-6 left-6 right-6 flex justify-between items-start z-10 pointer-events-none">
            <div class="flex gap-4">
                <div class="bg-white/95 p-4 px-6 rounded-3xl shadow-lg border-2 border-blue-50 min-w-[170px]">
                    <h1 class="text-xl font-bold text-blue-600 leading-tight">Stage <span id="level-num">1</span>/5</h1>
                    <p class="text-blue-400 font-bold text-xs uppercase" id="level-desc">Ice Surface</p>
                </div>
                <div class="bg-white/95 p-4 px-6 rounded-3xl shadow-lg border-2 border-blue-50">
                    <div class="text-[10px] uppercase font-bold text-blue-300">Physics Hint</div>
                    <div class="text-sm font-bold text-blue-800 leading-tight">Minimum Push: <span id="clue-force">--</span>N</div>
                </div>
            </div>
            
            <div class="bg-white/95 p-4 px-6 rounded-3xl shadow-lg border-2 border-orange-50 text-right">
                <div class="text-[10px] font-bold text-orange-400 uppercase">Mass</div>
                <div class="text-2xl font-black text-orange-600 leading-tight" id="mass-display">50 kg</div>
            </div>
        </div>

        <!-- Canvas Area -->
        <canvas id="gameCanvas" class="w-full h-[360px] block gradient-bg"></canvas>

        <!-- Control Panel -->
        <div class="p-8 bg-blue-50/50 border-t-2 border-white">
            <div class="flex flex-row gap-10 items-center max-w-5xl mx-auto">
                
                <div class="flex-1 group">
                    <div class="flex justify-between mb-3 items-end">
                        <label class="text-sm font-bold text-blue-800 uppercase tracking-widest">Set Push Force</label>
                        <span id="force-value" class="text-3xl font-black text-blue-600 bg-white px-6 py-1 rounded-full shadow-inner border border-blue-100">250 N</span>
                    </div>
                    <input type="range" id="force-slider" min="0" max="2500" value="250" 
                        class="w-full h-5 bg-blue-200 rounded-full appearance-none cursor-pointer accent-blue-600">
                    <div class="flex justify-between mt-2 text-blue-300 font-bold text-[10px] uppercase tracking-tighter">
                        <span>Tap</span>
                        <span>Medium Push</span>
                        <span>Mega Force</span>
                    </div>
                </div>

                <div class="w-1/3">
                    <button id="launch-btn" class="bubbly-button bg-green-500 text-white w-full py-5 rounded-[1.5rem] text-3xl font-black shadow-lg">
                        LAUNCH!
                    </button>
                </div>
            </div>
        </div>

        <!-- Overlays -->
        <div id="overlay" class="absolute inset-0 bg-blue-900/40 backdrop-blur-md hidden flex items-center justify-center z-20 p-6">
            <div class="bg-white p-10 rounded-[3rem] shadow-2xl text-center transform scale-0 transition-transform duration-500 border-[10px] border-blue-50" id="msg-card">
                <div id="msg-icon" class="mb-5 text-7xl"></div>
                <h2 id="msg-title" class="text-4xl font-black text-blue-900 mb-3 tracking-tight">Success!</h2>
                <p id="msg-text" class="text-blue-600/70 text-lg font-medium mb-8 max-w-sm mx-auto leading-relaxed"></p>
                <button id="next-btn" class="bubbly-button bg-blue-500 text-white px-16 py-4 rounded-2xl font-black text-2xl shadow-lg">
                    CONTINUE
                </button>
            </div>
        </div>
    </div>

    <script>
        /** AUDIO SYSTEM **/
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, type = 'sine', duration = 0.1, volume = 0.1) {
            try {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
                gain.gain.setValueAtTime(volume, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + duration);
            } catch(e) {}
        }

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const forceSlider = document.getElementById('force-slider');
        const forceDisplay = document.getElementById('force-value');
        const launchBtn = document.getElementById('launch-btn');
        const nextBtn = document.getElementById('next-btn');
        const beginBtn = document.getElementById('begin-btn');
        const startScreen = document.getElementById('start-screen');
        const overlay = document.getElementById('overlay');
        const msgCard = document.getElementById('msg-card');
        const clueEl = document.getElementById('clue-force');

        // Simple Constants for Game Feel
        const GRAVITY = 9.8;
        const FRICTION_MULTIPLIER = 0.08; // Simplified friction scale

        // Game State
        let gameState = 'start';
        let level = 1;
        let mass = 50; 
        let frictionCoeff = 0.1;
        let robotX = 100;
        let velocity = 0;
        let targetX = 0;
        let targetWidth = 220; 
        let particles = [];
        let struggleTimer = 0;
        let floorY = 0;
        
        const levels = [
            { name: "Slick Ice", friction: 0.04, mass: 40 },
            { name: "Park Grass", friction: 0.22, mass: 70 },
            { name: "Basketball Court", friction: 0.35, mass: 85 },
            { name: "Smooth Stone", friction: 0.46, mass: 100 },
            { name: "Thick Carpet", friction: 0.58, mass: 115 } 
        ];

        function resize() {
            const rect = canvas.parentNode.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 360;
            targetX = canvas.width - 300;
            floorY = canvas.height - 80;
        }

        window.addEventListener('resize', resize);
        resize();

        function createDust(x, y, color = 'rgba(150, 150, 150,') {
            particles.push({
                x: x, y: y,
                vx: -Math.random() * 2 - 1,
                vy: -Math.random() * 1.5,
                life: 1.0,
                size: Math.random() * 5 + 3,
                color: color
            });
        }

        function drawRobot(x, y) {
            ctx.save();
            ctx.translate(x, y);
            
            const isMoving = Math.abs(velocity) > 0.01;
            let wobble = 0;
            let lean = 0;

            if (gameState === 'struggling') {
                wobble = (Math.random() - 0.5) * 5;
                if (Math.random() > 0.7) createDust(-10, -50, 'rgba(255, 255, 255,');
            } else if (isMoving) {
                wobble = Math.sin(Date.now() / 80) * 4;
                lean = Math.min(velocity / 15, 0.15);
            }

            ctx.rotate(lean);
            ctx.translate(wobble, wobble);

            // Shadow
            ctx.fillStyle = 'rgba(0,0,0,0.06)';
            ctx.beginPath(); ctx.ellipse(0, 0, 40, 10, 0, 0, Math.PI * 2); ctx.fill();

            // Wheels
            ctx.fillStyle = '#1e293b';
            ctx.beginPath();
            ctx.roundRect(-28, -22, 20, 22, 8);
            ctx.roundRect(12, -22, 20, 22, 8);
            ctx.fill();

            // Body
            ctx.fillStyle = '#3b82f6';
            ctx.beginPath(); ctx.roundRect(-42, -95, 84, 80, 24); ctx.fill();

            // Face
            ctx.fillStyle = '#0f172a';
            ctx.beginPath(); ctx.roundRect(-32, -85, 64, 40, 14); ctx.fill();

            // Eyes
            ctx.fillStyle = '#93c5fd';
            const blink = (Math.sin(Date.now() / 400) > 0.95) ? 0.1 : 1;
            ctx.beginPath(); ctx.arc(-14, -65, 7, 0, Math.PI * 2); ctx.arc(14, -65, 7, 0, Math.PI * 2); ctx.fill();
            if (blink < 0.5) { ctx.fillStyle = '#0f172a'; ctx.fillRect(-22, -72, 44, 7); }

            // Force Arrow
            if (gameState === 'idle') {
                const f = parseInt(forceSlider.value);
                const arrowLen = (f / 2500) * 200;
                if (arrowLen > 5) {
                    ctx.strokeStyle = '#fbbf24';
                    ctx.lineWidth = 12;
                    ctx.lineCap = 'round';
                    ctx.beginPath(); ctx.moveTo(50, -55); ctx.lineTo(50 + arrowLen, -55); ctx.stroke();
                    ctx.fillStyle = '#fbbf24';
                    ctx.beginPath(); ctx.moveTo(50 + arrowLen + 15, -55); ctx.lineTo(50 + arrowLen, -68); ctx.lineTo(50 + arrowLen, -42); ctx.fill();
                }
            }
            ctx.restore();
        }

        function drawEnvironment() {
            let colors = [
                { g: '#e0f2fe', d: '#bae6fd' }, // Ice
                { g: '#dcfce7', d: '#bbf7d0' }, // Grass
                { g: '#fb923c', d: '#fde68a' }, // Basketball (Polished Wood)
                { g: '#e2e8f0', d: '#cbd5e1' }, // Smooth Stone
                { g: '#f5d0fe', d: '#f5f3ff' }  // Carpet
            ][level-1];

            ctx.fillStyle = colors.g;
            ctx.fillRect(0, floorY, canvas.width, 100);

            // Ground Particles
            ctx.fillStyle = colors.detail;
            for(let i=0; i<canvas.width; i+=150) {
                ctx.beginPath(); ctx.arc(i + (Math.cos(i)*50), floorY + 20, 5, 0, Math.PI * 2); ctx.fill();
            }

            // Target Landing Pad
            ctx.save();
            ctx.translate(targetX, floorY);
            ctx.fillStyle = 'rgba(34, 197, 94, 0.3)';
            ctx.fillRect(0, 0, targetWidth, 100);
            ctx.strokeStyle = '#16a34a';
            ctx.lineWidth = 6;
            ctx.setLineDash([15, 10]);
            ctx.strokeRect(3, 3, targetWidth-6, 94);
            
            ctx.fillStyle = '#14532d';
            ctx.font = 'bold 20px Fredoka';
            ctx.textAlign = 'center';
            ctx.fillText('GOAL', targetWidth/2, 45);
            ctx.restore();
        }

        function update() {
            // Update Particles
            for(let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx; p.y += p.vy; p.life -= 0.02;
                if(p.life <= 0) particles.splice(i, 1);
            }

            if (gameState === 'moving') {
                // FORM 2 SIMPLIFIED PHYSICS:
                // Velocity reduces by a constant "Friction Drag" every frame
                const drag = frictionCoeff * 0.15;
                velocity -= drag;

                if (velocity < 0) velocity = 0;
                robotX += velocity;

                // Dust effect
                if (velocity > 0.5 && Math.random() > 0.6) createDust(robotX - 25, floorY);

                // Check Stop
                if (velocity <= 0) {
                    gameState = 'waiting';
                    setTimeout(() => {
                        gameState = 'finished';
                        checkResult();
                    }, 1000); 
                }
                
                // Overshoot check
                if (robotX > canvas.width + 120) {
                    gameState = 'waiting';
                    setTimeout(() => {
                        gameState = 'finished';
                        checkResult();
                    }, 1000);
                }
            } else if (gameState === 'struggling') {
                struggleTimer++;
                if (struggleTimer > 50) {
                    gameState = 'waiting';
                    setTimeout(() => {
                        gameState = 'finished';
                        checkResult();
                    }, 1000);
                }
            }
        }

        function checkResult() {
            const centerOfBot = robotX;
            const inZone = centerOfBot > targetX && centerOfBot < (targetX + targetWidth);
            
            if (inZone) {
                if (level === 5) {
                    showOverlay('final', "Physics Master!", "You delivered all 5 packages! You understand how Force, Mass, and Friction work together.");
                } else {
                    showOverlay('win', "Perfect Push!", "Success! You used enough force to overcome friction and reach the goal.");
                }
            } else if (robotX <= targetX) {
                const f_friction = Math.round(frictionCoeff * mass * GRAVITY);
                showOverlay('fail', "Too Weak!", `Static Friction was ${f_friction}N. You need a bigger push to slide all the way to the goal!`);
            } else {
                showOverlay('fail', "Too Much Force!", "Newton's 1st Law: The robot kept moving past the goal! Try a smaller push.");
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawEnvironment();
            particles.forEach(p => {
                ctx.fillStyle = `${p.color}${p.life})`;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2); ctx.fill();
            });
            drawRobot(robotX, floorY);
            update();
            requestAnimationFrame(draw);
        }

        function showOverlay(type, title, text) {
            overlay.classList.remove('hidden');
            setTimeout(() => {
                msgCard.classList.remove('scale-0');
                msgCard.classList.add('scale-100');
            }, 50);

            const icon = document.getElementById('msg-icon');
            const titleEl = document.getElementById('msg-title');
            const textEl = document.getElementById('msg-text');
            const btn = document.getElementById('next-btn');
            
            if (type === 'win') {
                icon.innerHTML = 'âœ¨ðŸ“¦âœ¨';
                titleEl.className = "text-4xl font-black text-green-500 mb-3";
                btn.textContent = "NEXT STAGE";
                playSound(600, 'square', 0.1); setTimeout(() => playSound(800, 'square', 0.2), 100);
            } else if (type === 'final') {
                icon.innerHTML = 'ðŸ†ðŸ†ðŸ†';
                titleEl.className = "text-4xl font-black text-yellow-500 mb-3";
                btn.textContent = "PLAY AGAIN";
                playSound(500, 'square', 0.1); setTimeout(() => playSound(650, 'square', 0.1), 100); setTimeout(() => playSound(850, 'square', 0.4), 250);
            } else {
                icon.innerHTML = 'ðŸ¤–âš ï¸';
                titleEl.className = "text-4xl font-black text-orange-500 mb-3";
                btn.textContent = "RE-TRY";
                playSound(150, 'sawtooth', 0.5);
            }
            titleEl.textContent = title;
            textEl.textContent = text;
        }

        function initLevel() {
            const data = levels[level - 1];
            mass = data.mass;
            frictionCoeff = data.friction;
            document.getElementById('level-num').textContent = level;
            document.getElementById('level-desc').textContent = data.name;
            document.getElementById('mass-display').textContent = `${mass} kg`;
            const minForceNeeded = Math.ceil(frictionCoeff * mass * GRAVITY);
            clueEl.textContent = minForceNeeded;
            resetLevel();
        }

        function resetLevel() {
            robotX = 100;
            velocity = 0;
            struggleTimer = 0;
            gameState = 'idle';
            overlay.classList.add('hidden');
            msgCard.classList.add('scale-0');
            particles = [];
        }

        forceSlider.addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            forceDisplay.textContent = val + ' N';
            playSound(120 + (val/20), 'sine', 0.05, 0.04);
        });

        launchBtn.addEventListener('click', () => {
            if (gameState === 'idle') {
                const f = parseInt(forceSlider.value);
                const frictionForce = frictionCoeff * mass * GRAVITY;
                
                if (f <= frictionForce) {
                    gameState = 'struggling';
                    playSound(130, 'sawtooth', 0.4);
                } else {
                    // Initial velocity based on (Push - Friction) / Mass
                    const netForce = f - frictionForce;
                    velocity = (netForce / mass) * 2.1; 
                    
                    // Increased velocity cap for higher distance on high-friction levels
                    velocity = Math.min(velocity, 18);

                    gameState = 'moving';
                    playSound(500, 'triangle', 0.4);
                }
            }
        });

        nextBtn.addEventListener('click', () => {
            const currentTitle = msgCard.querySelector('h2').textContent;
            if (currentTitle === "Success!" || currentTitle === "Perfect Push!") {
                level++;
                initLevel();
            } else if (currentTitle === "Physics Master!") {
                level = 1;
                initLevel();
            } else {
                resetLevel();
            }
        });

        beginBtn.addEventListener('click', () => {
            startScreen.classList.add('opacity-0', 'pointer-events-none');
            playSound(550, 'sine', 0.2);
            initLevel();
        });

        draw();
    </script>
</body>
</html>