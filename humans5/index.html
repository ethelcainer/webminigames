<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Systems Lab: Standard 5 Science</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            background: #020617; /* Deep night base */
            overflow: hidden;
            touch-action: none;
            transition: background 0.5s ease;
        }

        /* --- Blood Theme Override --- */
        body.blood-theme { background: #0f0202; }
        .blood-theme .science-particle { background: #ef4444; box-shadow: 0 0 10px rgba(239, 68, 68, 0.5); }
        .blood-theme .bone-tray { border-color: #f87171; }
        .blood-theme .progress-fill { background-color: #ef4444 !important; }
        .blood-theme .theme-text { color: #991b1b !important; }
        .blood-theme .theme-border { border-color: #fee2e2 !important; }
        .blood-theme .theme-bg { background-color: #ef4444 !important; }

        /* --- Parallax Scenery --- */
        .parallax-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            background: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
        }

        .science-particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.15;
            pointer-events: none;
            filter: blur(2px);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        /* --- Animations --- */
        /* @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            15% { transform: scale(1.1); }
            30% { transform: scale(1); }
            45% { transform: scale(1.15); }
            70% { transform: scale(1); }
        } */

        .heart-beat {
            animation: heartbeat 1.5s infinite ease-in-out;
            transform-origin: center;
        }

        .shake { animation: errorShake 0.3s ease-in-out; }

        .bone-tray {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 4px solid #7dd3fc;
        }

        .draggable-bone {
            cursor: grab;
            transition: all 0.2s ease;
        }

        .bone-hidden {
            opacity: 0;
            pointer-events: none;
        }

        .bone-visible {
            opacity: 1 !important;
            fill: #000000 !important;
            transition: opacity 0.2s ease, transform 0.2s ease;
        }

        .overlay {
            background: rgba(12, 74, 110, 0.9);
            backdrop-filter: blur(8px);
            z-index: 100;
        }

        #confetti-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 150;
        }

        .info-card {
            min-height: 250px;
            display: flex;
            flex-direction: column;
            border: 4px solid #bae6fd;
            transition: all 0.3s ease;
        }

        .transition-overlay {
            position: fixed;
            inset: 0;
            background: #020617;
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
        }
    </style>
</head>
<body class="h-screen flex items-center justify-center p-4">

    <div id="transition-screen" class="transition-overlay">
        <h2 class="text-4xl font-bold mb-4">SYSTEM SYNCED!</h2>
        <p class="text-xl text-sky-300">Switching to Blood Circulatory Lab...</p>
    </div>

    <div class="parallax-bg" id="bg-glow">
        <div class="science-particle" style="top: 15%; left: 10%; width: 40px; height: 40px;"></div>
        <div class="science-particle" style="top: 65%; left: 20%; width: 20px; height: 20px;"></div>
        <div class="science-particle" style="top: 25%; right: 15%; width: 60px; height: 60px;"></div>
        <div class="science-particle" style="bottom: 15%; right: 10%; width: 30px; height: 30px;"></div>
        <div class="science-particle" style="top: 45%; left: 45%; width: 15px; height: 15px;"></div>
    </div>

    <canvas id="confetti-canvas"></canvas>

    <div id="start-screen" class="fixed inset-0 overlay flex items-center justify-center text-center p-6">
        <div class="bg-white p-10 rounded-[3rem] shadow-2xl max-w-md border-8 border-sky-300">
            <h1 class="text-5xl font-bold text-sky-800 mb-4">Human Systems Lab</h1>
            <p class="text-sky-600 text-lg mb-8">Master the Skeletal & Blood Circulatory Systems. Precision is key to anatomical mastery!</p>
            <button onclick="startGame()" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-4 px-10 rounded-2xl text-2xl shadow-lg transition-transform active:scale-95">
                START LAB
            </button>
        </div>
    </div>

    <div id="game-over-screen" class="fixed inset-0 overlay hidden flex items-center justify-center text-center p-6">
        <div class="bg-white p-10 rounded-[3rem] shadow-2xl max-w-md border-8 border-green-300">
            <h2 class="text-5xl font-bold text-green-700 mb-4">Lab Complete!</h2>
            <p class="text-green-600 text-lg mb-8">You are now an expert on how the human body stays strong and keeps blood flowing!</p>
            <button onclick="window.location.reload()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-10 rounded-2xl text-2xl shadow-lg transition-transform active:scale-95">
                NEW LAB SESSION
            </button>
        </div>
    </div>

    <main id="game-container" class="opacity-0 transition-opacity duration-1000 flex flex-row gap-8 items-center justify-center w-full max-w-7xl">
        
        <div id="tray-outer" class="bone-tray w-72 p-6 rounded-[2.5rem] shadow-xl flex flex-col items-center">
            <h2 id="tray-title" class="text-xl font-bold text-sky-800 mb-4 theme-text">Bone Tray</h2>
            <div id="tray-container" class="grid grid-cols-2 gap-4"></div>
        </div>

        <div id="main-stage" class="relative bg-white p-8 rounded-[3.5rem] shadow-2xl border-8 border-white">
            <svg id="target-svg" viewBox="0 0 400 400" width="500" height="500" xmlns="http://www.w3.org/2000/svg">
                <g id="ghost-skeleton" opacity="0.08" fill="black">
                    <circle id="target-skull-group" cx="200" cy="60" r="30" />
                    <rect id="target-backbone" x="196" y="95" width="8" height="125" rx="4" />
                    <path id="target-ribcage" d="M 170 115 Q 200 100 230 115 Q 230 123 200 110 Q 170 123 170 115 Z" />
                    <ellipse id="target-pelvis" cx="200" cy="225" rx="35" ry="15" />
                    
                    <g id="target-left-arm-full" transform="rotate(40, 175, 110)">
                        <rect x="170" y="110" width="10" height="60" rx="5" />
                        <g transform="rotate(35, 175, 170)">
                            <rect x="171" y="170" width="8" height="50" rx="4" />
                            <circle cx="175" cy="225" r="5" />
                        </g>
                    </g>
                    <g id="target-right-arm-full" transform="rotate(-40, 225, 110)">
                        <rect x="220" y="110" width="10" height="60" rx="5" />
                        <g transform="rotate(-35, 225, 170)">
                            <rect x="221" y="170" width="8" height="50" rx="4" />
                            <circle cx="225" cy="225" r="5" />
                        </g>
                    </g>

                    <g id="target-left-leg-full">
                        <rect x="181" y="235" width="11" height="65" rx="5.5" transform="rotate(3, 186.5, 235)" />
                        <rect x="179" y="300" width="10" height="65" rx="5" transform="rotate(-2, 184, 300)" />
                        <rect x="170" y="365" width="30" height="10" rx="5" />
                    </g>
                    <g id="target-right-leg-full">
                        <rect x="208" y="235" width="11" height="65" rx="5.5" transform="rotate(-3, 213.5, 235)" />
                        <rect x="211" y="300" width="10" height="65" rx="5" transform="rotate(2, 216, 300)" />
                        <rect x="200" y="365" width="30" height="10" rx="5" />
                    </g>
                </g>

                <g id="main-skeleton">
                    <g id="skull-group" class="bone-hidden">
                        <circle cx="200" cy="60" r="30" fill="black" />
                        <path d="M 180 80 Q 200 105 220 80 L 215 90 Q 200 105 185 90 Z" fill="black"/>
                        <circle fill="white" cx="188" cy="60" r="5" />
                        <circle fill="white" cx="212" cy="60" r="5" />
                    </g>
                    <rect id="backbone" class="bone-hidden" x="196" y="95" width="8" height="125" rx="4" />
                    <g id="ribcage" class="bone-hidden">
                        <path d="M 170 115 Q 200 100 230 115 Q 230 123 200 110 Q 170 123 170 115 Z" />
                        <path d="M 167 135 Q 200 120 233 135 Q 233 143 200 130 Q 167 143 167 135 Z" />
                        <path d="M 170 155 Q 200 140 230 155 Q 230 163 200 150 Q 170 163 170 155 Z" />
                        <path d="M 180 175 Q 200 165 220 175 Q 220 183 200 173 Q 180 183 180 175 Z" />
                    </g>
                    <g id="pelvis" class="bone-hidden">
                        <ellipse cx="185" cy="225" rx="18" ry="15" />
                        <ellipse cx="215" cy="225" rx="18" ry="15" />
                    </g>
                    <g id="left-arm-full" class="bone-hidden" transform="rotate(40, 175, 110)">
                        <circle cx="175" cy="110" r="6" />
                        <rect x="170" y="110" width="10" height="60" rx="5" />
                        <circle cx="175" cy="170" r="6" />
                        <g transform="rotate(35, 175, 170)">
                            <rect x="171" y="170" width="8" height="50" rx="4" />
                            <g transform="translate(170, 220)">
                                <circle cx="5" cy="5" r="5" />
                                <rect x="0" y="5" width="4" height="12" rx="2" transform="rotate(15, 2, 5)" />
                                <rect x="4" y="6" width="4" height="14" rx="2" />
                                <rect x="8" y="5" width="4" height="12" rx="2" transform="rotate(-15, 10, 5)" />
                            </g>
                        </g>
                    </g>
                    <g id="right-arm-full" class="bone-hidden" transform="rotate(-40, 225, 110)">
                        <circle cx="225" cy="110" r="6" />
                        <rect x="220" y="110" width="10" height="60" rx="5" />
                        <circle cx="225" cy="170" r="6" />
                        <g transform="rotate(-35, 225, 170)">
                            <rect x="221" y="170" width="8" height="50" rx="4" />
                            <g transform="translate(220, 220)">
                                <circle cx="5" cy="5" r="5" />
                                <rect x="0" y="5" width="4" height="12" rx="2" transform="rotate(15, 2, 5)" />
                                <rect x="4" y="6" width="4" height="14" rx="2" />
                                <rect x="8" y="5" width="4" height="12" rx="2" transform="rotate(-15, 10, 5)" />
                            </g>
                        </g>
                    </g>
                    <g id="left-leg-full" class="bone-hidden">
                        <rect x="181" y="235" width="11" height="65" rx="5.5" transform="rotate(3, 186.5, 235)" />
                        <circle cx="184" cy="300" r="7" />
                        <rect x="179" y="300" width="10" height="65" rx="5" transform="rotate(-2, 184, 300)" />
                        <rect x="170" y="365" width="30" height="10" rx="5" />
                    </g>
                    <g id="right-leg-full" class="bone-hidden">
                        <rect x="208" y="235" width="11" height="65" rx="5.5" transform="rotate(-3, 213.5, 235)" />
                        <circle cx="216" cy="300" r="7" />
                        <rect x="211" y="300" width="10" height="65" rx="5" transform="rotate(2, 216, 300)" />
                        <rect x="200" y="365" width="30" height="10" rx="5" />
                    </g>
                </g>
            </svg>

            <svg id="blood-svg" class="hidden" viewBox="0 0 400 400" width="500" height="500" xmlns="http://www.w3.org/2000/svg">
                <path d="M 200 80 L 200 130" stroke="#ef4444" stroke-width="3" fill="none" marker-end="url(#arrow-red)" />
                <path d="M 220 180 L 220 280" stroke="#ef4444" stroke-width="3" fill="none" marker-end="url(#arrow-red)" />
                <path d="M 180 280 L 180 180" stroke="#991b1b" stroke-width="3" fill="none" marker-end="url(#arrow-dark)" />
                <path d="M 200 130 L 200 80" stroke="#991b1b" stroke-width="3" fill="none" marker-end="url(#arrow-dark)" />
                
                <defs>
                    <marker id="arrow-red" markerWidth="6" markerHeight="6" refX="3" refY="3" orient="auto"><path d="M0,0 L6,3 L0,6 Z" fill="#ef4444"/></marker>
                    <marker id="arrow-dark" markerWidth="6" markerHeight="6" refX="3" refY="3" orient="auto"><path d="M0,0 L6,3 L0,6 Z" fill="#991b1b"/></marker>
                </defs>

                <text x="210" y="110" font-size="11" font-weight="bold" fill="#ef4444">Oxygenated (O2)</text>
                <text x="230" y="230" font-size="11" font-weight="bold" fill="#ef4444">O2 to Body</text>
                <text x="55" y="230" font-size="11" font-weight="bold" fill="#991b1b">Deoxygenated (CO2)</text>

                <rect id="target-lungs" x="125" y="20" width="150" height="60" rx="10" fill="#fee2e2" stroke="#f87171" stroke-dasharray="5,5" />
                <rect id="target-heart" x="150" y="130" width="100" height="50" rx="10" fill="#fee2e2" stroke="#f87171" stroke-dasharray="5,5" />
                <rect id="target-body" x="125" y="280" width="150" height="60" rx="10" fill="#fee2e2" stroke="#f87171" stroke-dasharray="5,5" />

                <g id="lungs" class="bone-hidden">
                    <rect x="125" y="20" width="150" height="60" rx="10" fill="#ef4444" />
                    <text x="200" y="55" text-anchor="middle" fill="white" font-weight="bold">LUNGS</text>
                </g>
                <g id="heart" class="bone-hidden">
                    <rect x="150" y="130" width="100" height="50" rx="10" fill="#991b1b" />
                    <text x="200" y="160" text-anchor="middle" fill="white" font-weight="bold">HEART</text>
                </g>
                <g id="body" class="bone-hidden">
                    <rect x="125" y="280" width="150" height="60" rx="10" fill="#450a0a" />
                    <text x="200" y="315" text-anchor="middle" fill="white" font-weight="bold">HUMAN BODY</text>
                </g>
            </svg>
        </div>

        <div class="flex flex-col gap-6 w-80">
            <div class="bg-white p-6 rounded-[2.5rem] shadow-lg border-4 border-sky-100 theme-border">
                <h3 class="text-sky-800 font-bold text-center text-xl mb-3 theme-text">Lab Progress</h3>
                <div class="w-full bg-sky-100 h-6 rounded-full overflow-hidden mb-2 theme-border">
                    <div id="progress-bar" class="bg-sky-500 h-full transition-all duration-500 progress-fill" style="width: 0%"></div>
                </div>
                <p id="score-text" class="text-center text-sky-600 font-bold text-lg theme-text">0 / 8 Bones Found</p>
            </div>

            <div id="info-box" class="info-card bg-white p-6 rounded-[2.5rem] shadow-lg theme-border">
                <div id="info-content" class="text-center overflow-y-auto">
                    <p class="text-sky-400 font-bold text-lg italic uppercase tracking-widest theme-text">Lab Journal Entry</p>
                    <p id="journal-placeholder" class="text-sky-700 mt-4 px-2 theme-text">Awaiting specimen assembly. Drag components to their correct locations to log data.</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        let currentRound = 1;
        let placedCount = 0;

        const BONE_FACTS = {
            'skull-group': { name: 'Skull', function: 'The skull is a hard, bony structure that protects the most vital organ: our brain.' },
            'backbone': { name: 'Backbone', function: 'The backbone (vertebral column) allows us to stand upright and protects the spinal cord.' },
            'ribcage': { name: 'Ribcage', function: 'The ribs form a protective cage around the chest cavity, shielding the heart and lungs.' },
            'pelvis': { name: 'Pelvis', function: 'The pelvis supports the weight of the upper body and protects vital internal organs.' },
            'left-arm-full': { name: 'Arm Bones', function: 'These bones provide the internal framework for the upper limbs, enabling lifting and grasping.' },
            'right-arm-full': { name: 'Arm Bones', function: 'These bones provide the internal framework for the upper limbs, enabling lifting and grasping.' },
            'left-leg-full': { name: 'Leg Bones', function: 'The largest bones. They support our body weight and allow for walking and jumping.' },
            'right-leg-full': { name: 'Leg Bones', function: 'The largest bones. They support our body weight and allow for walking and jumping.' }
        };

        const BLOOD_FACTS = {
            'lungs': { name: 'Lungs', function: 'The place where gas exchange happens. Blood picks up Oxygen (O2) and drops off Carbon Dioxide (CO2) here.' },
            'heart': { name: 'Heart', function: 'The muscular pump that pushes oxygenated blood to the whole body and deoxygenated blood to the lungs.' },
            'body': { name: 'Human Body', function: 'The body parts use up the oxygen and nutrients, then send blood rich in Carbon Dioxide back to the heart.' }
        };

        const BONES = [
            { id: 'skull-group', label: 'Skull', svg: '<circle cx="20" cy="15" r="10" fill="black"/>' },
            { id: 'backbone', label: 'Backbone', svg: '<rect x="18" y="5" width="4" height="30" rx="2" fill="black"/>' },
            { id: 'ribcage', label: 'Ribs', svg: '<path d="M 10 10 Q 20 0 30 10 Q 30 20 20 10 Q 10 20 10 10" fill="black"/>' },
            { id: 'pelvis', label: 'Pelvis', svg: '<circle cx="15" cy="20" r="5" fill="black"/><circle cx="25" cy="20" r="5" fill="black"/>' },
            { id: 'left-arm-full', label: 'L-Arm', svg: '<rect x="18" y="5" width="4" height="25" rx="2" transform="rotate(30,20,20)" fill="black"/>' },
            { id: 'right-arm-full', label: 'R-Arm', svg: '<rect x="18" y="5" width="4" height="25" rx="2" transform="rotate(-30,20,20)" fill="black"/>' },
            { id: 'left-leg-full', label: 'L-Leg', svg: '<rect x="18" y="5" width="4" height="30" rx="2" fill="black"/>' },
            { id: 'right-leg-full', label: 'R-Leg', svg: '<rect x="18" y="5" width="4" height="30" rx="2" fill="black"/>' }
        ];

        const BLOOD_COMPONENTS = [
            { id: 'lungs', label: 'Lungs', svg: '<ellipse cx="20" cy="20" rx="15" ry="10" fill="#ef4444"/>' },
            { id: 'heart', label: 'Heart', svg: '<path d="M20 30 L10 20 A5 5 0 0 1 20 10 A5 5 0 0 1 30 20 Z" fill="#991b1b"/>' },
            { id: 'body', label: 'Body', svg: '<rect x="10" y="10" width="20" height="20" rx="5" fill="#450a0a"/>' }
        ];

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSfx(type) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            if (type === 'pop') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start(); osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'error') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start(); osc.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'success') {
                [523, 659, 783].forEach((f, i) => {
                    const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);
                    o.frequency.setValueAtTime(f, audioCtx.currentTime + (i * 0.1));
                    g.gain.setValueAtTime(0.05, audioCtx.currentTime + (i * 0.1));
                    g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                    o.start(audioCtx.currentTime + (i * 0.1)); o.stop(audioCtx.currentTime + 0.5);
                });
            }
        }

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            const container = document.getElementById('game-container');
            container.classList.remove('opacity-0');
            initRound();
            initParallax();
        }

        function initParallax() {
            window.addEventListener('mousemove', (e) => {
                const particles = document.querySelectorAll('.science-particle');
                const x = (e.clientX - window.innerWidth / 2) / 60;
                const y = (e.clientY - window.innerHeight / 2) / 60;
                particles.forEach((p, i) => {
                    const depth = (i + 1) * 0.4;
                    p.style.transform = `translate(${x * depth}px, ${y * depth}px)`;
                });
            });
        }

        function initRound() {
            const tray = document.getElementById('tray-container');
            tray.innerHTML = '';
            placedCount = 0;
            updateProgress();

            const items = currentRound === 1 ? BONES : BLOOD_COMPONENTS;
            
            [...items].sort(() => Math.random() - 0.5).forEach(item => {
                const div = document.createElement('div');
                div.className = 'draggable-bone bg-white p-3 rounded-2xl shadow border-2 border-sky-50 flex flex-col items-center justify-center';
                div.draggable = true;
                div.dataset.id = item.id;
                div.innerHTML = `<svg width="40" height="40" viewBox="0 0 40 40">${item.svg}</svg><span class="text-[10px] font-bold text-sky-800 uppercase mt-1 theme-text">${item.label}</span>`;
                div.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', item.id);
                    div.classList.add('scale-110');
                });
                div.addEventListener('dragend', () => div.classList.remove('scale-110'));
                tray.appendChild(div);
            });
        }

        const mainStage = document.getElementById('main-stage');
        mainStage.addEventListener('dragover', (e) => e.preventDefault());
        mainStage.addEventListener('drop', (e) => {
            e.preventDefault();
            const id = e.dataTransfer.getData('text/plain');
            const sourceEl = document.querySelector(`[data-id="${id}"]`);
            const targetSvg = currentRound === 1 ? document.getElementById('target-svg') : document.getElementById('blood-svg');
            
            const rect = targetSvg.getBoundingClientRect();
            const dropX = e.clientX - rect.left;
            const dropY = e.clientY - rect.top;
            
            const ghostTarget = document.getElementById('target-' + id);
            const targetBBox = ghostTarget.getBBox();
            
            const targetCenterX = (targetBBox.x + targetBBox.width / 2) * (rect.width / 400);
            const targetCenterY = (targetBBox.y + targetBBox.height / 2) * (rect.height / 400);
            
            const dist = Math.hypot(dropX - targetCenterX, dropY - targetCenterY);
            
            if (dist < 80) {
                tryPlace(id, sourceEl);
            } else {
                triggerError();
            }
        });

        function triggerError() {
            const tray = document.getElementById('tray-outer');
            tray.classList.add('shake', 'border-red-400');
            playSfx('error');
            setTimeout(() => tray.classList.remove('shake', 'border-red-400'), 300);
        }

        function tryPlace(id, sourceEl) {
            const target = document.getElementById(id);
            if (target && target.classList.contains('bone-hidden')) {
                target.classList.remove('bone-hidden');
                target.classList.add('bone-visible');
                
                // Add heartbeat to heart component in round 2
                // if (currentRound === 2 && id === 'heart') {
                //     target.classList.add('heart-beat');
                // }

                if (sourceEl) sourceEl.classList.add('opacity-0', 'pointer-events-none', 'scale-0');
                updateInfo(id);
                placedCount++;
                updateProgress();
                playSfx('pop');
                
                const total = currentRound === 1 ? BONES.length : BLOOD_COMPONENTS.length;
                if (placedCount === total) {
                    if (currentRound === 1) {
                        setTimeout(transitionToRound2, 1000);
                    } else {
                        handleWin();
                    }
                }
            }
        }

        function transitionToRound2() {
            const transitionScreen = document.getElementById('transition-screen');
            if (!transitionScreen) return;
            
            transitionScreen.style.display = 'flex';
            if (audioCtx.state === 'suspended') audioCtx.resume();
            playSfx('success');

            setTimeout(() => {
                currentRound = 2;
                transitionScreen.style.display = 'none';
                try {
                    document.body.classList.add('blood-theme');
                    document.getElementById('target-svg').classList.add('hidden');
                    document.getElementById('blood-svg').classList.remove('hidden');
                    
                    const trayTitle = document.getElementById('tray-title');
                    if (trayTitle) trayTitle.innerText = "Blood Components";
                    
                    const journal = document.getElementById('journal-placeholder');
                    if (journal) journal.innerText = "Skeleton synced. Analyzing blood circulatory system flow...";
                    
                    initRound();
                } catch (err) {
                    console.error("Transition error:", err);
                }
            }, 2000);
        }

        function updateInfo(id) {
            const data = currentRound === 1 ? BONE_FACTS[id] : BLOOD_FACTS[id];
            const infoBox = document.getElementById('info-box');
            const content = document.getElementById('info-content');
            
            const themeCol = currentRound === 1 ? 'sky' : 'red';
            
            infoBox.classList.add(`border-${themeCol}-400`);
            content.innerHTML = `
                <h4 class="text-${themeCol}-800 font-bold text-xl uppercase">${data.name}</h4>
                <div class="h-1 w-12 bg-${themeCol}-200 mx-auto my-2 rounded-full"></div>
                <p class="text-${themeCol}-600 font-medium text-sm leading-relaxed text-justify px-2">${data.function}</p>
            `;
            setTimeout(() => infoBox.classList.remove(`border-${themeCol}-400`), 300);
        }

        function updateProgress() {
            const bar = document.getElementById('progress-bar');
            const text = document.getElementById('score-text');
            const total = currentRound === 1 ? BONES.length : BLOOD_COMPONENTS.length;
            const percent = (placedCount / total) * 100;
            bar.style.width = percent + '%';
            text.innerText = `${placedCount} / ${total} ${currentRound === 1 ? 'Bones' : 'Parts'} Logged`;
        }

        function handleWin() {
            setTimeout(() => {
                playSfx('success');
                document.getElementById('game-over-screen').classList.remove('hidden');
                startConfetti();
            }, 800);
        }

        function startConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            let particles = Array.from({ length: 120 }, () => ({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                s: Math.random() * 8 + 4,
                c: `hsl(${Math.random() * 360}, 70%, 60%)`,
                v: Math.random() * 3 + 4
            }));
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(p => {
                    p.y += p.v;
                    ctx.fillStyle = p.c;
                    ctx.fillRect(p.x, p.y, p.s, p.s);
                });
                if (particles.length > 0 && particles[0].y < canvas.height) requestAnimationFrame(animate);
            }
            animate();
        }
    </script>
</body>
</html>