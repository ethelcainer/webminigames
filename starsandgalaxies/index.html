<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellar Odyssey: Survival</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #050510;
            --retro-pink: #ff00ff;
            --retro-blue: #00ffff;
            --retro-yellow: #ffff00;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-deep);
            color: white;
            font-family: 'Press Start 2P', cursive;
            overflow: hidden;
            image-rendering: pixelated;
            user-select: none;
        }

        /* CRT Scanline Overlay */
        .crt-overlay {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            z-index: 100;
            background-size: 100% 4px, 3px 100%;
            pointer-events: none;
        }

        #game-canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        .pixel-border {
            border: 4px solid white;
            box-shadow: 6px 6px 0px rgba(0,0,0,0.5);
            background: rgba(0, 0, 0, 0.9);
        }

        .btn-retro {
            background-color: var(--retro-pink);
            padding: 12px 20px;
            cursor: pointer;
            border: 4px solid #fff;
            transition: all 0.1s;
            font-size: 10px;
            box-shadow: 4px 4px 0px #800080;
        }

        .btn-retro:active {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0px #800080;
        }

        .hud-text { font-size: 10px; text-transform: uppercase; }
        
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            pointer-events: none; z-index: 50;
        }

        #ui-layer * { pointer-events: auto; }
        .hidden { display: none !important; }

        @keyframes pulse-red {
            0%, 100% { color: #fff; }
            50% { color: #ff0000; }
        }
        .low-fuel { animation: pulse-red 0.5s infinite; }

        .fact-item {
            font-size: 8px;
            line-height: 1.4;
            margin-bottom: 10px;
            color: #00ffff;
            text-align: left;
            border-left: 2px solid #ff00ff;
            padding-left: 10px;
        }
    </style>
</head>
<body>

    <div class="crt-overlay"></div>
    <canvas id="game-canvas"></canvas>

    <!-- HUD -->
    <div id="hud" class="fixed top-5 left-5 right-5 flex justify-between pointer-events-none hidden z-40">
        <div class="flex flex-col gap-2">
            <div class="pixel-border p-2 hud-text">
                DISTANCE: <span id="distance-val" class="text-[#00ffff]">0</span> LY
            </div>
            <div class="pixel-border p-2 hud-text">
                CORES: <span id="cores-val" class="text-[#ffff00]">0</span>/5
            </div>
        </div>
        <div class="flex flex-col items-end gap-2">
            <div class="pixel-border p-2 hud-text" id="fuel-container">
                FUEL: [<span id="fuel-bar" class="text-green-400">||||||||||</span>]
            </div>
            <div id="zone-display" class="text-[8px] text-[#ff00ff]">ZONE: NEBULA</div>
        </div>
    </div>

    <div id="ui-layer">
        <!-- Start Screen -->
        <div id="start-screen" class="flex flex-col items-center">
            <div class="mb-8 text-center">
                <h1 class="text-4xl md:text-6xl font-bold tracking-tighter text-[#00ffff] drop-shadow-[4px_4px_0_#ff00ff]">STELLAR</h1>
                <h1 class="text-4xl md:text-6xl font-bold tracking-tighter text-[#ff00ff] drop-shadow-[4px_4px_0_#00ffff]">ODYSSEY</h1>
                <p class="mt-4 text-[8px] opacity-70">EVADE DEBRIS • COLLECT CORES • SURVIVE</p>
            </div>
            
            <button onclick="startGame()" class="btn-retro">INITIATE ENGINES</button>
            <div class="mt-10 grid grid-cols-2 gap-4 text-[8px] text-center max-w-xs">
                <div class="p-2 border border-white/20">MOUSE/TOUCH<br>TO MOVE</div>
                <div class="p-2 border border-white/20 text-[#ffff00]">YELLOW DISKS<br>ARE DATA</div>
            </div>
        </div>

        <!-- Fact Pop-up -->
        <div id="fact-panel" class="pixel-border p-6 max-w-md hidden text-center">
            <h2 class="text-[#00ffff] mb-4 text-xs">DATA CORE ENCRYPTED</h2>
            <p id="fact-text" class="text-[10px] leading-relaxed mb-6"></p>
            <button onclick="resumeGame()" class="btn-retro">SYNC DATA</button>
        </div>

        <!-- Game Over -->
        <div id="game-over" class="pixel-border p-8 flex flex-col items-center hidden max-w-lg w-11/12 overflow-y-auto max-h-[90vh]">
            <h2 class="text-2xl text-red-500 mb-2">SYSTEM FAILURE</h2>
            <p id="death-reason" class="text-[8px] mb-4 opacity-80 text-center"></p>
            <div class="text-xs mb-4">FINAL SCORE: <span id="final-score" class="text-[#ffff00]"></span></div>
            
            <div class="w-full mb-6">
                <h3 class="text-[10px] text-white border-b border-white/20 pb-2 mb-4">MISSION LOG: DISCOVERIES</h3>
                <div id="discovery-log"></div>
            </div>

            <button onclick="location.reload()" class="btn-retro">REBOOT PROBE</button>
        </div>
    </div>

    <script>
        // --- Game Config & Data ---
        const FACTS = [
            "Stars are born in NEBULAE: giant clouds of gas and dust pulled by gravity.",
            "The SUN is an average star. It will eventually expand into a RED GIANT.",
            "White Dwarfs are the small, extremely dense remains of stars like our Sun.",
            "SPIRAL GALAXIES have a central bulge and arms, just like our Milky Way.",
            "Star colors indicate TEMPERATURE: Blue stars are the hottest, Red stars are the coolest."
        ];

        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let gameState = 'start';
        let score = 0;
        let fuel = 100;
        let collectedCores = 0;
        let speedMultiplier = 1;
        let frameCount = 0;
        let isLooping = false;

        // --- Audio Engine ---
        let audioCtx;
        try {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
            console.error("AudioContext not supported");
        }

        function playSfx(freq, type, duration, vol = 0.1) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        const sounds = {
            collect: () => { playSfx(880, 'square', 0.1); setTimeout(()=>playSfx(1320, 'square', 0.1), 50); },
            hurt: () => playSfx(100, 'sawtooth', 0.3, 0.2),
            fuel: () => playSfx(660, 'sine', 0.2),
            start: () => playSfx(440, 'triangle', 0.5),
            discovery: () => { playSfx(220, 'sine', 1, 0.15); playSfx(330, 'sine', 1.5, 0.1); }
        };

        // --- Entities ---
        let ship = { y: 0, targetY: 0, w: 40, h: 25, trail: [] };
        let obstacles = [];
        let pickups = [];
        let bgStars = [];
        let landmark = null; 

        function init() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            ship.y = height / 2;
            ship.targetY = height / 2;
            
            bgStars = Array.from({length: 100}, () => ({
                x: Math.random() * width,
                y: Math.random() * height,
                s: Math.random() * 2 + 1,
                v: Math.random() * 3 + 1
            }));
        }

        function spawnEntity() {
            if (frameCount % Math.max(15, Math.floor(50 / speedMultiplier)) === 0) {
                const type = Math.random() > 0.65 ? 'pickup' : 'obstacle';
                const y = Math.random() * (height - 100) + 50;
                
                if (type === 'obstacle') {
                    obstacles.push({ x: width + 100, y, w: 30 + Math.random() * 40, h: 30 });
                } else {
                    // Optimized core spawn logic: Probability increased to 0.4 from 0.85 
                    // to make discoveries happen sooner as the game speeds up.
                    const shouldSpawnCore = (collectedCores < 5) && (landmark === null) && (Math.random() > 0.4);
                    const isCore = shouldSpawnCore;
                    
                    if (isCore || Math.random() > 0.4) {
                        pickups.push({ x: width + 100, y, r: 10, isCore, color: isCore ? '#ffff00' : '#00ff00' });
                    }
                }
            }
        }

        function drawLandmark() {
            if (!landmark) return;
            landmark.x -= 2 * speedMultiplier;
            
            ctx.save();
            ctx.translate(landmark.x, height / 2);
            ctx.globalAlpha = 0.5;

            const idx = landmark.typeIndex;
            
            if (idx === 0) { // Nebula
                ctx.fillStyle = '#ff00ff';
                for(let i=0; i<20; i++) {
                    const px = Math.cos(i) * (80 + Math.random() * 40);
                    const py = Math.sin(i) * (80 + Math.random() * 40);
                    ctx.fillRect(px, py, 100, 100);
                    ctx.fillStyle = i % 2 === 0 ? '#4b0082' : '#ff00ff';
                }
            } else if (idx === 1) { // Red Giant
                const grad = ctx.createRadialGradient(0, 0, 150, 0, 0, 250);
                grad.addColorStop(0, '#ff4500');
                grad.addColorStop(1, 'transparent');
                ctx.fillStyle = grad;
                ctx.beginPath(); ctx.arc(0, 0, 250, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = '#ff4500';
                ctx.beginPath(); ctx.arc(0, 0, 200, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = '#8b0000';
                for(let i=0; i<8; i++) {
                    ctx.fillRect(Math.sin(i)*100, Math.cos(i)*80, 20, 20);
                }
            } else if (idx === 2) { // White Dwarf
                ctx.fillStyle = '#ffffff';
                ctx.shadowBlur = 100;
                ctx.shadowColor = '#00ffff';
                ctx.fillRect(-40, -40, 80, 80);
                ctx.fillRect(-200, -2, 400, 4);
                ctx.fillRect(-2, -200, 4, 400);
            } else if (idx === 3) { // Spiral Galaxy
                ctx.rotate(frameCount * 0.01);
                for(let arm=0; arm<4; arm++) {
                    ctx.rotate(Math.PI/2);
                    for(let i=0; i<30; i++) {
                        const r = i * 10;
                        const angle = i * 0.2;
                        ctx.fillStyle = `rgba(0, 255, 255, ${1 - i/30})`;
                        ctx.fillRect(Math.cos(angle)*r, Math.sin(angle)*r, 15, 15);
                    }
                }
                ctx.fillStyle = '#fff';
                ctx.fillRect(-20, -20, 40, 40);
            } else { // Star Temperature
                ctx.fillStyle = '#00ffff'; // Blue
                ctx.fillRect(-250, -100, 180, 180);
                ctx.fillStyle = '#fff';
                ctx.font = '10px "Press Start 2P"';
                ctx.fillText("HOT", -200, 120);
                ctx.fillStyle = '#ff0000'; // Red
                ctx.fillRect(70, -100, 180, 180);
                ctx.fillText("COOL", 120, 120);
            }

            ctx.restore();
            ctx.globalAlpha = 1.0;
            ctx.shadowBlur = 0;

            if (landmark.x < -1500) landmark = null;
        }

        function drawShip() {
            ship.trail.push({x: width * 0.15, y: ship.y});
            if (ship.trail.length > 20) ship.trail.shift();
            
            ship.trail.forEach((t, i) => {
                ctx.fillStyle = `rgba(255, 0, 255, ${i/20})`;
                ctx.fillRect(t.x - (20-i)*2, t.y - 2, 4, 4);
            });

            ctx.save();
            ctx.translate(width * 0.15, ship.y);
            ctx.fillStyle = frameCount % 4 < 2 ? '#ff00ff' : '#00ffff';
            ctx.fillRect(-35, -5, 15, 10);
            ctx.fillStyle = '#fff';
            ctx.fillRect(-20, -12, 40, 24);
            ctx.fillStyle = '#00ffff';
            ctx.fillRect(5, -8, 15, 16);
            ctx.restore();
        }

        function drawObstacles() {
            obstacles.forEach((ob, i) => {
                ob.x -= 5 * speedMultiplier;
                ctx.fillStyle = '#333';
                ctx.fillRect(ob.x, ob.y, ob.w, ob.h);
                ctx.fillStyle = '#555';
                ctx.fillRect(ob.x + 4, ob.y + 4, ob.w - 8, ob.h - 8);
                
                if (Math.abs(ob.x - width * 0.15) < ob.w/2 + 20 && Math.abs(ob.y - ship.y) < ob.h/2 + 15) {
                    endGame("HULL BREACH: ASTEROID IMPACT");
                }
            });
            obstacles = obstacles.filter(ob => ob.x > -200);
        }

        function drawPickups() {
            pickups.forEach((pk, i) => {
                pk.x -= 4 * speedMultiplier;
                ctx.save();
                ctx.translate(pk.x, pk.y);
                ctx.rotate(frameCount * 0.1);
                ctx.fillStyle = pk.color;
                ctx.fillRect(-10, -10, 20, 20);
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.strokeRect(-10, -10, 20, 20);
                ctx.restore();

                if (Math.abs(pk.x - width * 0.15) < 35 && Math.abs(pk.y - ship.y) < 25) {
                    if (pk.isCore) {
                        sounds.collect();
                        triggerFact();
                    } else {
                        sounds.fuel();
                        fuel = Math.min(100, fuel + 30);
                    }
                    pickups.splice(i, 1);
                }
            });
            pickups = pickups.filter(pk => pk.x > -100);
        }

        function updateHUD() {
            document.getElementById('distance-val').innerText = Math.floor(score);
            document.getElementById('cores-val').innerText = collectedCores;
            
            const fuelBar = document.getElementById('fuel-bar');
            const bars = Math.max(0, Math.floor(fuel / 10));
            fuelBar.innerText = "|".repeat(bars).padEnd(10, ' ');
            
            if (fuel < 30) document.getElementById('fuel-container').classList.add('low-fuel');
            else document.getElementById('fuel-container').classList.remove('low-fuel');

            const zones = ["NEBULA", "STAR CLUSTER", "RED GIANT ZONE", "BLACK HOLE RIM", "GALACTIC CORE"];
            const zoneIdx = Math.min(zones.length - 1, Math.floor(score / 1500));
            document.getElementById('zone-display').innerText = "ZONE: " + zones[zoneIdx];
        }

        function loop() {
            if (gameState !== 'playing') {
                isLooping = false;
                return;
            }
            isLooping = true;

            ctx.fillStyle = '#050510';
            ctx.fillRect(0, 0, width, height);

            bgStars.forEach(s => {
                s.x -= s.v * speedMultiplier;
                if (s.x < 0) s.x = width;
                ctx.fillStyle = '#fff';
                ctx.fillRect(s.x, s.y, s.s, s.s);
            });

            frameCount++;
            score += 0.5 * speedMultiplier;
            fuel -= 0.05; 
            speedMultiplier = 1 + (score / 4000);

            if (fuel <= 0) endGame("ENERGY DEPLETED: DRIFTING IN VOID");

            ship.y += (ship.targetY - ship.y) * 0.15;

            if (collectedCores >= 5 && landmark === null && frameCount % 1200 === 0) {
                landmark = { x: width + 1000, typeIndex: Math.floor(Math.random() * 5) };
            }

            drawLandmark();
            spawnEntity();
            drawObstacles();
            drawPickups();
            drawShip();
            updateHUD();

            requestAnimationFrame(loop);
        }

        function triggerFact() {
            gameState = 'fact';
            const fact = FACTS[collectedCores % FACTS.length];
            document.getElementById('fact-panel').classList.remove('hidden');
            document.getElementById('fact-text').innerText = fact;
        }

        window.startGame = function() {
            if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
            sounds.start();
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('hud').classList.remove('hidden');
            gameState = 'playing';
            init();
            if (!isLooping) loop();
        };

        window.resumeGame = function() {
            sounds.discovery();
            landmark = { x: width + 1000, typeIndex: collectedCores % FACTS.length }; 
            collectedCores++; 
            document.getElementById('fact-panel').classList.add('hidden');
            gameState = 'playing';
            if (!isLooping) loop();
        };

        function endGame(reason) {
            gameState = 'game-over';
            sounds.hurt();
            document.getElementById('game-over').classList.remove('hidden');
            document.getElementById('death-reason').innerText = reason;
            document.getElementById('final-score').innerText = Math.floor(score);
            
            const log = document.getElementById('discovery-log');
            log.innerHTML = '';
            for(let i=0; i < Math.min(collectedCores, 5); i++) {
                const item = document.createElement('div');
                item.className = 'fact-item';
                item.innerText = FACTS[i];
                log.appendChild(item);
            }
            if(collectedCores === 0) {
                log.innerHTML = '<p class="text-[8px] opacity-50">No data cores retrieved.</p>';
            }
        }

        const handleInput = (y) => { ship.targetY = y; };
        window.addEventListener('mousemove', e => handleInput(e.clientY));
        window.addEventListener('touchmove', e => {
            e.preventDefault();
            handleInput(e.touches[0].clientY);
        }, {passive: false});
        window.addEventListener('resize', init);

        init();
    </script>
</body>
</html>